FROM ubuntu:latest

RUN apt update && \
    apt install -y git build-essential gnutls-dev

RUN useradd -ms /bin/bash ftpuser

WORKDIR /home/ftpuser
USER ftpuser

RUN git clone https://github.com/hfiref0x/LightFTP.git && \
    cd LightFTP && \
    git checkout 85c6a90fba274f40cd2435fb181c818c9396aaa6 && \
    cd Source/Release && \
    make

RUN mkdir -p /home/ftpuser/ftpshare && echo "Hello World!" > /home/ftpuser/ftpshare/hello.txt

COPY ./fftp.conf /home/ftpuser/fftp.conf

CMD ["./LightFTP/Source/Release/fftp", "./fftp.conf"]
